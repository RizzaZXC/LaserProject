<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>–†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç–µ–Ω</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
  body {
    margin: 0;
    background: #f3f4f7;
    font-family: Arial, Helvetica, sans-serif;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    overflow-x: hidden;
  }

  .app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    position: relative;
  }

  .header {
    background: #fff;
    border-bottom: 1px solid #ddd;
    padding: 12px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 20;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    flex-shrink: 0;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    background: #fff;
    display: flex;
    flex-direction: column;
  }

  #wallsList {
    flex: 1;
    padding: 0;
    overflow-y: auto;
  }

  .walls-container {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .wall-item {
    display: flex;
    align-items: center;
    padding: 12px;
    border-bottom: 1px solid #e9ecef;
    background: #fff;
    position: relative;
    transition: transform 0.3s ease;
    touch-action: pan-y;
    user-select: none;
  }

  .wall-item:last-child {
    border-bottom: none;
  }

  .wall-number {
    width: 32px;
    height: 32px;
    background: #0d6efd;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    margin-right: 12px;
    flex-shrink: 0;
  }

  .wall-info {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-right: 12px;
  }

  .info-group {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .info-label {
    font-size: 10px;
    color: #666;
  }

  .info-value {
    font-size: 14px;
    font-weight: 600;
    color: #333;
  }

  .wall-preview {
    width: 80px;
    height: 60px;
    background: #f8f9fa;
    border-radius: 6px;
    position: relative;
    border: 1px solid #e9ecef;
    overflow: hidden;
    flex-shrink: 0;
  }

  .preview-line {
    position: absolute;
    transform-origin: 0 0;
  }

  .preview-line.past {
    border-bottom: 2px dashed #6c757d;
    height: 0;
  }

  .preview-line.current {
    background: #333;
    height: 2px;
  }

  .preview-point {
    position: absolute;
    border-radius: 50%;
    transform: translate(-50%, -50%);
  }

  .preview-point.start {
    background: #28a745;
    width: 6px;
    height: 6px;
  }

  .preview-point.end {
    background: #dc3545;
    width: 6px;
    height: 6px;
  }

  .delete-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: #dc3545;
    color: white;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 20px;
    font-weight: bold;
    font-size: 14px;
    transform: translateX(100%);
    transition: transform 0.3s ease;
  }

  .wall-item.deleting .delete-overlay {
    transform: translateX(0);
  }

  .swipe-hint {
    text-align: center;
    color: #666;
    font-size: 12px;
    padding: 8px;
    background: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
  }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #666;
  }

  .empty-state .icon {
    font-size: 48px;
    margin-bottom: 12px;
    opacity: 0.5;
  }

  .empty-state .text {
    font-size: 14px;
    margin-bottom: 16px;
  }

  /* –ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω–æ–µ –º–µ–Ω—é –≤–Ω–∏–∑—É */
  .fixed-bottom-menu {
    background: #fff;
    border-top: 1px solid #ddd;
    padding: 12px;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    flex-shrink: 0;
  }

  .controls {
    background: #fff;
    padding: 12px 0;
  }

  .control-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 12px;
  }

  .control-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .control-label {
    font-size: 12px;
    color: #666;
    font-weight: 500;
    text-align: center;
  }

  .length-control, .angle-control {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 8px;
  }

  .length-display, .angle-display {
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: #333;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 6px;
    border: 1px solid #ced4da;
  }

  .length-display input {
    border: none;
    outline: none;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: #333;
    background: transparent;
    width: 100%;
    padding: 0;
  }

  .length-hint, .angle-hint {
    text-align: center;
    font-size: 10px;
    color: #666;
    margin-top: 4px;
  }

  /* –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ —É–≥–ª–∞ */
  .angle-quick-buttons {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 6px;
    margin-top: 8px;
  }

  .angle-btn {
    padding: 6px 4px;
    font-size: 12px;
    font-weight: 600;
    border: 1px solid #ced4da;
    background: #fff;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .angle-btn:hover {
    background: #f8f9fa;
  }

  .angle-btn.active {
    background: #0d6efd;
    color: white;
    border-color: #0d6efd;
  }

  .btn-add-wall {
    width: 100%;
    height: 44px;
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 12px;
  }

  .btn-view-plan {
    width: 100%;
    height: 44px;
    font-size: 16px;
    font-weight: 600;
  }

  .angle-change-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(25, 118, 210, 0.9);
    color: white;
    padding: 6px 10px;
    border-radius: 16px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    z-index: 10;
    font-size: 12px;
  }

  .angle-change-indicator.show {
    opacity: 1;
  }
</style>
</head>

<body>
<div class="app-container">
  <div class="header">
    <h1 class="h5 mb-0">–†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç–µ–Ω</h1>
  </div>

  <div class="content">
    <div id="wallsList">
      <div class="swipe-hint">‚Üê –°–≤–∞–π–ø–Ω–∏—Ç–µ –≤–ª–µ–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–µ–Ω—ã</div>
      <div class="empty-state">
        <div class="icon">üèóÔ∏è</div>
        <div class="text">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç–µ–Ω—É</div>
      </div>
    </div>
  </div>

  <!-- –ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω–æ–µ –º–µ–Ω—é –≤–Ω–∏–∑—É -->
  <div class="fixed-bottom-menu">
    <div class="controls">
      <div class="control-row">
        <div class="control-group">
          <label class="control-label">–î–ª–∏–Ω–∞ (–º)</label>
          <div class="length-control">
            <div class="length-display">
              <input type="number" step="0.1" min="0.1" max="10" value="2.0" id="wallLength">
            </div>
            <div class="length-hint">–¢–∞–ø –¥–ª—è –≤–≤–æ–¥–∞</div>
          </div>
        </div>
        
        <div class="control-group">
          <label class="control-label">–£–≥–æ–ª (¬∞)</label>
          <div class="angle-control">
            <div class="angle-display" id="angleValue">
              90¬∞
              <div class="angle-change-indicator" id="angleChangeIndicator">+15¬∞</div>
            </div>
            <div class="angle-hint">–°–≤–∞–π–ø –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑</div>
            
            <!-- –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ —É–≥–ª–∞ (—Ç–µ–ø–µ—Ä—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ) -->
            <div class="angle-quick-buttons">
              <button class="angle-btn" data-angle="-90">-90¬∞</button>
              <button class="angle-btn" data-angle="-45">-45¬∞</button>
              <button class="angle-btn" data-angle="0">0¬∞</button>
              <button class="angle-btn" data-angle="45">45¬∞</button>
              <button class="angle-btn" data-angle="90">90¬∞</button>
            </div>
          </div>
        </div>
      </div>

      <button id="btnAddWall" class="btn btn-primary btn-add-wall">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–µ–Ω—É</button>
      <button id="btnViewPlan" class="btn btn-success btn-view-plan" disabled>
        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω
      </button>
    </div>
  </div>
</div>

<script>
// –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç–µ–Ω–∞—Ö
let walls = [];
let currentAngle = 90;

// –ë—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π —Å—Ç–µ–Ω –≤ –ø—Ä–µ–≤—å—é
let previewPositions = [];

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–µ–Ω –∏–∑ localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
function loadWalls() {
  const savedWalls = localStorage.getItem('roomWalls');
  if (savedWalls) {
    walls = JSON.parse(savedWalls);
    calculatePreviewPositions();
    refreshList();
    updateViewPlanButton();
  }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–µ–Ω –≤ localStorage
function saveWalls() {
  localStorage.setItem('roomWalls', JSON.stringify(walls));
  updateViewPlanButton();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–ª–∞–Ω–∞
function updateViewPlanButton() {
  const btn = document.getElementById('btnViewPlan');
  btn.disabled = walls.length === 0;
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–µ–Ω—ã
function addWall(length, angle) {
  const wall = {
    id: Date.now() + Math.random(),
    length: parseFloat(length),
    angle: parseFloat(angle)
  };
  
  walls.push(wall);
  calculatePreviewPositions();
  saveWalls();
  refreshList();
  
  // –°–±—Ä–æ—Å –¥–ª–∏–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  document.getElementById('wallLength').value = '2.0';
  
  return wall;
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–µ–Ω—ã –ø–æ –∏–Ω–¥–µ–∫—Å—É
function deleteWall(index) {
  if (index >= 0 && index < walls.length) {
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –æ–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–æ–π —Å—Ç–µ–Ω–æ–π
    removeWindowsAndDoorsByWallIndex(index);
    
    // –£–¥–∞–ª—è–µ–º —Å–∞–º—É —Å—Ç–µ–Ω—É
    walls.splice(index, 1);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã —Å—Ç–µ–Ω –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –æ–∫–æ–Ω –∏ –¥–≤–µ—Ä–µ–π
    updateWindowsAndDoorsWallIndexes(index);
    
    calculatePreviewPositions();
    saveWalls();
    refreshList();
  }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–∫–æ–Ω –∏ –¥–≤–µ—Ä–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —É–¥–∞–ª—è–µ–º–æ–π —Å—Ç–µ–Ω–æ–π
function removeWindowsAndDoorsByWallIndex(wallIndex) {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏
  const savedWindows = localStorage.getItem('roomWindows');
  const savedDoors = localStorage.getItem('roomDoors');
  
  let windows = [];
  let doors = [];
  
  if (savedWindows) {
    windows = JSON.parse(savedWindows);
  }
  if (savedDoors) {
    doors = JSON.parse(savedDoors);
  }
  
  // –£–¥–∞–ª—è–µ–º –æ–∫–Ω–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–æ–π —Å—Ç–µ–Ω–æ–π
  windows = windows.filter(window => window.wallIndex !== wallIndex);
  
  // –£–¥–∞–ª—è–µ–º –¥–≤–µ—Ä–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–æ–π —Å—Ç–µ–Ω–æ–π
  doors = doors.filter(door => door.wallIndex !== wallIndex);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã
  localStorage.setItem('roomWindows', JSON.stringify(windows));
  localStorage.setItem('roomDoors', JSON.stringify(doors));
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å—Ç–µ–Ω –¥–ª—è –æ–∫–æ–Ω –∏ –¥–≤–µ—Ä–µ–π –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–µ–Ω—ã
function updateWindowsAndDoorsWallIndexes(deletedIndex) {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏
  const savedWindows = localStorage.getItem('roomWindows');
  const savedDoors = localStorage.getItem('roomDoors');
  
  let windows = [];
  let doors = [];
  
  if (savedWindows) {
    windows = JSON.parse(savedWindows);
  }
  if (savedDoors) {
    doors = JSON.parse(savedDoors);
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–∫–æ–Ω (—É–º–µ–Ω—å—à–∞–µ–º –Ω–∞ 1 –¥–ª—è –≤—Å–µ—Ö –æ–∫–æ–Ω —Å wallIndex > deletedIndex)
  windows.forEach(window => {
    if (window.wallIndex > deletedIndex) {
      window.wallIndex--;
    }
  });
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –¥–≤–µ—Ä–µ–π (—É–º–µ–Ω—å—à–∞–µ–º –Ω–∞ 1 –¥–ª—è –≤—Å–µ—Ö –¥–≤–µ—Ä–µ–π —Å wallIndex > deletedIndex)
  doors.forEach(door => {
    if (door.wallIndex > deletedIndex) {
      door.wallIndex--;
    }
  });
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã
  localStorage.setItem('roomWindows', JSON.stringify(windows));
  localStorage.setItem('roomDoors', JSON.stringify(doors));
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≥–ª–∞
function updateAngleDisplay() {
  const angleValue = document.getElementById('angleValue');
  const text = angleValue.childNodes[0];
  if (text.nodeType === Node.TEXT_NODE) {
    text.textContent = currentAngle + '¬∞';
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞
  const angleButtons = document.querySelectorAll('.angle-btn');
  angleButtons.forEach(btn => {
    const btnAngle = parseInt(btn.dataset.angle);
    if (btnAngle === currentAngle) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É–≥–ª–∞ —Å —à–∞–≥–æ–º 15 –≥—Ä–∞–¥—É—Å–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –æ—Ç -180 –¥–æ 180
function changeAngle(delta) {
  let newAngle = currentAngle + delta;
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —É–≥–æ–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ -180 –¥–æ 180
  if (newAngle > 180) {
    newAngle = -180 + (newAngle - 180);
  } else if (newAngle < -180) {
    newAngle = 180 + (newAngle + 180);
  }
  
  currentAngle = newAngle;
  updateAngleDisplay();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è
  const indicator = document.getElementById('angleChangeIndicator');
  indicator.textContent = (delta > 0 ? '+' : '') + delta + '¬∞';
  indicator.classList.add('show');
  
  setTimeout(() => {
    indicator.classList.remove('show');
  }, 500);
}

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–≥–ª–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é
function setAngle(angle) {
  currentAngle = angle;
  updateAngleDisplay();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è
  const indicator = document.getElementById('angleChangeIndicator');
  indicator.textContent = angle + '¬∞';
  indicator.classList.add('show');
  
  setTimeout(() => {
    indicator.classList.remove('show');
  }, 500);
}

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –ø—Ä–µ–≤—å—é —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª–∏–Ω–æ–π –ª–∏–Ω–∏–π
function calculatePreviewPositions() {
  previewPositions = [];
  const centerX = 40;
  const centerY = 30;
  const fixedLength = 25; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–ª–∏–Ω–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–µ–Ω –≤ –ø—Ä–µ–≤—å—é
  
  let currentX = centerX;
  let currentY = centerY;
  let currentAngle = 0;
  
  // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–µ–Ω—ã
  for (let i = 0; i < walls.length; i++) {
    const wall = walls[i];
    const angleRad = (currentAngle + wall.angle) * Math.PI / 180;
    const endX = currentX + Math.cos(angleRad) * fixedLength;
    const endY = currentY + Math.sin(angleRad) * fixedLength;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ —Å—Ç–µ–Ω—ã
    previewPositions.push({
      startX: currentX,
      startY: currentY,
      endX: endX,
      endY: endY,
      angle: currentAngle + wall.angle
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –∏ —É–≥–æ–ª –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–µ–Ω—ã
    currentX = endX;
    currentY = endY;
    currentAngle += wall.angle;
  }
}

// –°–æ–∑–¥–∞–Ω–∏–µ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π –º–∏–Ω–∏–∞—Ç—é—Ä—ã —Å—Ç–µ–Ω—ã —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º
function createWallPreview(wallIndex) {
  const preview = document.createElement('div');
  preview.className = 'wall-preview';
  
  // –î–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç–µ–Ω—ã - –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–µ, —Ü–µ–Ω—Ç—Ä–∏—Ä—É—è
  if (wallIndex === 0) {
    const pos = previewPositions[0];
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª–∏–Ω—É –∏ —É–≥–æ–ª –ª–∏–Ω–∏–∏
    const length = Math.sqrt(Math.pow(pos.endX - pos.startX, 2) + Math.pow(pos.endY - pos.startY, 2));
    const lineAngle = Math.atan2(pos.endY - pos.startY, pos.endX - pos.startX) * 180 / Math.PI;
    
    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ª–∏–Ω–∏—é –≤ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–µ–≤—å—é
    const centerX = 40;
    const centerY = 30;
    const midX = (pos.startX + pos.endX) / 2;
    const midY = (pos.startY + pos.endY) / 2;
    const offsetX = centerX - midX;
    const offsetY = centerY - midY;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
    const startPoint = document.createElement('div');
    startPoint.className = 'preview-point start';
    startPoint.style.left = (pos.startX + offsetX) + 'px';
    startPoint.style.top = (pos.startY + offsetY) + 'px';
    preview.appendChild(startPoint);
    
    // –°–æ–∑–¥–∞–µ–º —Å–ø–ª–æ—à–Ω—É—é –ª–∏–Ω–∏—é –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
    const currentLine = document.createElement('div');
    currentLine.className = 'preview-line current';
    currentLine.style.width = length + 'px';
    currentLine.style.left = (pos.startX + offsetX) + 'px';
    currentLine.style.top = (pos.startY + offsetY) + 'px';
    currentLine.style.transform = `rotate(${lineAngle}deg)`;
    preview.appendChild(currentLine);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω–µ—á–Ω—É—é —Ç–æ—á–∫—É –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
    const endPoint = document.createElement('div');
    endPoint.className = 'preview-point end';
    endPoint.style.left = (pos.endX + offsetX) + 'px';
    endPoint.style.top = (pos.endY + offsetY) + 'px';
    preview.appendChild(endPoint);
  } else {
    // –î–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∏ —Ç–µ–∫—É—â—É—é, —Ü–µ–Ω—Ç—Ä–∏—Ä—É—è –æ–±–µ
    const prevPos = previewPositions[wallIndex - 1];
    const currentPos = previewPositions[wallIndex];
    
    // –ù–∞—Ö–æ–¥–∏–º –æ–±—â–∏–π —Ü–µ–Ω—Ç—Ä –¥–ª—è –¥–≤—É—Ö –ª–∏–Ω–∏–π
    const allPoints = [
      {x: prevPos.startX, y: prevPos.startY},
      {x: prevPos.endX, y: prevPos.endY},
      {x: currentPos.startX, y: currentPos.startY},
      {x: currentPos.endX, y: currentPos.endY}
    ];
    
    // –ù–∞—Ö–æ–¥–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    let minX = Math.min(...allPoints.map(p => p.x));
    let maxX = Math.max(...allPoints.map(p => p.x));
    let minY = Math.min(...allPoints.map(p => p.y));
    let maxY = Math.max(...allPoints.map(p => p.y));
    
    // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –æ–±–ª–∞—Å—Ç–∏ –∏ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
    const centerX = 40;
    const centerY = 30;
    const midX = (minX + maxX) / 2;
    const midY = (minY + maxY) / 2;
    const offsetX = centerX - midX;
    const offsetY = centerY - midY;
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª–∏–Ω—É –∏ —É–≥–æ–ª –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ª–∏–Ω–∏–∏
    const prevLength = Math.sqrt(Math.pow(prevPos.endX - prevPos.startX, 2) + Math.pow(prevPos.endY - prevPos.startY, 2));
    const prevLineAngle = Math.atan2(prevPos.endY - prevPos.startY, prevPos.endX - prevPos.startX) * 180 / Math.PI;
    
    // –°–æ–∑–¥–∞–µ–º –ø—É–Ω–∫—Ç–∏—Ä–Ω—É—é –ª–∏–Ω–∏—é –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
    const prevLine = document.createElement('div');
    prevLine.className = 'preview-line past';
    prevLine.style.width = prevLength + 'px';
    prevLine.style.left = (prevPos.startX + offsetX) + 'px';
    prevLine.style.top = (prevPos.startY + offsetY) + 'px';
    prevLine.style.transform = `rotate(${prevLineAngle}deg)`;
    preview.appendChild(prevLine);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –Ω–∞—á–∞–ª–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
    if (wallIndex === 1) {
      const startPoint = document.createElement('div');
      startPoint.className = 'preview-point start';
      startPoint.style.left = (prevPos.startX + offsetX) + 'px';
      startPoint.style.top = (prevPos.startY + offsetY) + 'px';
      preview.appendChild(startPoint);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –∫–æ–Ω—Ü–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–µ–Ω—ã (–Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π) —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
    const prevEndPoint = document.createElement('div');
    prevEndPoint.className = 'preview-point start';
    prevEndPoint.style.left = (prevPos.endX + offsetX) + 'px';
    prevEndPoint.style.top = (prevPos.endY + offsetY) + 'px';
    preview.appendChild(prevEndPoint);
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª–∏–Ω—É –∏ —É–≥–æ–ª —Ç–µ–∫—É—â–µ–π –ª–∏–Ω–∏–∏
    const currentLength = Math.sqrt(Math.pow(currentPos.endX - currentPos.startX, 2) + Math.pow(currentPos.endY - currentPos.startY, 2));
    const currentLineAngle = Math.atan2(currentPos.endY - currentPos.startY, currentPos.endX - currentPos.startX) * 180 / Math.PI;
    
    // –°–æ–∑–¥–∞–µ–º —Å–ø–ª–æ—à–Ω—É—é –ª–∏–Ω–∏—é –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
    const currentLine = document.createElement('div');
    currentLine.className = 'preview-line current';
    currentLine.style.width = currentLength + 'px';
    currentLine.style.left = (currentPos.startX + offsetX) + 'px';
    currentLine.style.top = (currentPos.startY + offsetY) + 'px';
    currentLine.style.transform = `rotate(${currentLineAngle}deg)`;
    preview.appendChild(currentLine);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω–µ—á–Ω—É—é —Ç–æ—á–∫—É –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
    const endPoint = document.createElement('div');
    endPoint.className = 'preview-point end';
    endPoint.style.left = (currentPos.endX + offsetX) + 'px';
    endPoint.style.top = (currentPos.endY + offsetY) + 'px';
    preview.appendChild(endPoint);
  }
  
  return preview;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–µ–Ω –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
function refreshList() {
  const list = document.getElementById('wallsList');
  const emptyState = list.querySelector('.empty-state');
  
  if (walls.length === 0) {
    if (!emptyState) {
      list.innerHTML = `
        <div class="swipe-hint">‚Üê –°–≤–∞–π–ø–Ω–∏—Ç–µ –≤–ª–µ–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–µ–Ω—ã</div>
        <div class="empty-state">
          <div class="icon">üèóÔ∏è</div>
          <div class="text">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç–µ–Ω—É</div>
        </div>
      `;
    }
    return;
  }

  // –£–¥–∞–ª—è–µ–º empty state –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
  if (emptyState) {
    emptyState.remove();
  }

  let listHTML = `
    <div class="swipe-hint">‚Üê –°–≤–∞–π–ø–Ω–∏—Ç–µ –≤–ª–µ–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–µ–Ω—ã</div>
    <ul class="walls-container">
  `;
  
  walls.forEach((wall, index) => {
    listHTML += `
      <li class="wall-item" data-index="${index}">
        <div class="delete-overlay">–£–¥–∞–ª–∏—Ç—å</div>
        <div class="wall-number">${index + 1}</div>
        <div class="wall-info">
          <div class="info-group">
            <div class="info-label">–î–ª–∏–Ω–∞</div>
            <div class="info-value">${wall.length.toFixed(2)} –º</div>
          </div>
          <div class="info-group">
            <div class="info-label">–£–≥–æ–ª</div>
            <div class="info-value">${wall.angle}¬∞</div>
          </div>
        </div>
        <div class="wall-preview" id="preview-${index}"></div>
      </li>
    `;
  });
  
  listHTML += '</ul>';
  list.innerHTML = listHTML;
  
  // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–µ–Ω—ã
  walls.forEach((wall, index) => {
    const previewContainer = document.getElementById(`preview-${index}`);
    const preview = createWallPreview(index);
    previewContainer.appendChild(preview);
  });
  
  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–≤–∞–π–ø–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
  setupSwipeHandlers();
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–≤–∞–π–ø–∞
function setupSwipeHandlers() {
  const items = document.querySelectorAll('.wall-item');
  
  items.forEach(item => {
    let startX = 0;
    let currentX = 0;
    let isSwiping = true;
    
    item.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      isSwiping = true;
      e.preventDefault();
    }, { passive: false });
    
    item.addEventListener('touchmove', (e) => {
      if (!isSwiping) return;
      
      currentX = e.touches[0].clientX;
      const diff = startX - currentX;
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ
      if (diff > 0 && diff <= 120) {
        item.style.transform = `translateX(-${diff}px)`;
        e.preventDefault();
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º overlay –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º —Å–º–µ—â–µ–Ω–∏–∏
      if (diff > 60) {
        item.classList.add('deleting');
      } else {
        item.classList.remove('deleting');
      }
    }, { passive: false });
    
    item.addEventListener('touchend', () => {
      if (!isSwiping) return;
      
      const diff = startX - currentX;
      
      // –ï—Å–ª–∏ —Å–≤–∞–π–ø–Ω—É–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–ª–µ–∫–æ - —É–¥–∞–ª—è–µ–º
      if (diff > 80) {
        const index = parseInt(item.getAttribute('data-index'));
        deleteWall(index);
      } else {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –º–µ—Å—Ç–æ
        item.style.transform = 'translateX(0)';
        item.classList.remove('deleting');
      }
      
      isSwiping = false;
    });
  });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å—Ç–µ–Ω—ã
  loadWalls();
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≥–ª–∞
  updateAngleDisplay();
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∂–µ—Å—Ç–æ–≤ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–≥–ª–∞
  const angleDisplay = document.getElementById('angleValue');
  let startY = 0;
  let isChangingAngle = false;
  
  angleDisplay.addEventListener('touchstart', (e) => {
    startY = e.touches[0].clientY;
    isChangingAngle = true;
    e.preventDefault();
  });
  
  angleDisplay.addEventListener('touchmove', (e) => {
    if (!isChangingAngle) return;
    
    const currentY = e.touches[0].clientY;
    const diff = startY - currentY;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–∏–ª—É —Å–≤–∞–π–ø–∞
    if (Math.abs(diff) > 20) {
      const direction = diff > 0 ? 1 : -1;
      changeAngle(direction * 15);
      startY = currentY;
    }
    
    e.preventDefault();
  });
  
  angleDisplay.addEventListener('touchend', () => {
    isChangingAngle = false;
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ —É–≥–ª–∞ (—Ç–µ–ø–µ—Ä—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ)
  document.querySelectorAll('.angle-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const angle = parseInt(btn.dataset.angle);
      setAngle(angle);
    });
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
  document.getElementById('btnAddWall').addEventListener('click', () => {
    const length = document.getElementById('wallLength').value;
    
    if (length > 0) {
      addWall(length, currentAngle);
    }
  });
  
  document.getElementById('btnViewPlan').addEventListener('click', () => {
    window.location.href = 'plan.html';
  });
  
  // –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ Enter
  document.getElementById('wallLength').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      document.getElementById('btnAddWall').click();
    }
  });
});
</script>
</body>
</html>